"""
Configuración global del Malware Analyzer
"""
import os
from pathlib import Path

# Directorios del proyecto
BASE_DIR = Path(__file__).parent.parent
DATA_DIR = BASE_DIR / 'data'
CACHE_DIR = DATA_DIR / 'cache'
LOGS_DIR = BASE_DIR / 'logs'
REPORTS_DIR = BASE_DIR / 'reports'

# Crear directorios si no existen
for directory in [DATA_DIR, CACHE_DIR, LOGS_DIR, REPORTS_DIR]:
    directory.mkdir(parents=True, exist_ok=True)

# Base de datos de historial
HISTORY_DB = DATA_DIR / 'history.db'

# Límites de las APIs (cuentas gratuitas)
API_LIMITS = {
    'virustotal': {
        'requests_per_day': 500,
        'requests_per_minute': 4,
        'max_file_size': 650 * 1024 * 1024,  # 650MB
        'large_file_endpoint_size': 32 * 1024 * 1024,  # 32MB (usa endpoint especial)
    },
    'hybrid_analysis': {
        'requests_per_day': 200,
        'max_file_size': 100 * 1024 * 1024,  # 100MB
        'sandbox_types': ['win7_x64', 'win10_x64', 'android'],
    },
    'metadefender': {
        'requests_per_day': 100,
        'max_file_size': 80 * 1024 * 1024,  # 80MB
    },
    'abuseipdb': {
        'requests_per_day': 1000,
        'max_reports': 10000,  # Para cuentas gratuitas
    },
    'urlscan': {
        'requests_per_day': None,  # Sin límite oficial
        'visibility': 'public',  # public | unlisted | private (requiere pago)
    }
}

# Configuración de análisis de archivos grandes
LARGE_FILE_CONFIG = {
    'max_supported_size': 4 * 1024 * 1024 * 1024,  # 4GB
    'chunk_size': 100 * 1024 * 1024,  # 100MB chunks
    'hash_only_threshold': 650 * 1024 * 1024,  # Si >650MB, solo hash
    'analyze_header_size': 10 * 1024 * 1024,  # Primeros 10MB
    'analyze_footer_size': 10 * 1024 * 1024,  # Últimos 10MB
}

# Configuración de ClamAV (opcional para análisis local)
CLAMAV_CONFIG = {
    'enabled': False,
    'path': 'C:\\Program Files\\ClamAV\\clamscan.exe' if os.name == 'nt' else '/usr/bin/clamscan',
    'database_path': None,  # Dejar None para usar el default
    'max_scan_size': 4 * 1024 * 1024 * 1024,  # 4GB
}

# Configuración de timeouts
TIMEOUTS = {
    'api_request': 30,  # segundos
    'file_upload': 600,  # 10 minutos para archivos grandes
    'analysis_wait': 300,  # 5 minutos esperando resultados
}

# Configuración de caché
CACHE_CONFIG = {
    'enabled': True,
    'ttl': 86400,  # 24 horas en segundos
    'max_entries': 10000,
}

# Configuración de logging
LOGGING_CONFIG = {
    'level': 'INFO',  # DEBUG, INFO, WARNING, ERROR, CRITICAL
    'format': '%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    'max_bytes': 10 * 1024 * 1024,  # 10MB
    'backup_count': 5,
}

# Configuración de reportes
REPORT_CONFIG = {
    'formats': ['json', 'html'],  # json, html, pdf
    'include_screenshots': True,
    'include_graph': True,
    'template_dir': BASE_DIR / 'templates',
}

# Configuración de la GUI
GUI_CONFIG = {
    'theme': 'dark',  # dark | light
    'window_size': (1200, 800),
    'update_interval': 1000,  # ms
    'max_history_items': 1000,
}

# Umbrales de detección
DETECTION_THRESHOLDS = {
    'clean': 0,  # 0% de detección
    'suspicious': 10,  # 10% de detección
    'likely_malicious': 30,  # 30% de detección
    'malicious': 50,  # 50%+ de detección
}

# URLs de las APIs
API_URLS = {
    'virustotal': 'https://www.virustotal.com/api/v3',
    'hybrid_analysis': 'https://www.hybrid-analysis.com/api/v2',
    'metadefender': 'https://api.metadefender.com/v4',
    'abuseipdb': 'https://api.abuseipdb.com/api/v2',
    'urlscan': 'https://urlscan.io/api/v1',
}

# Nombres de las claves en el keyring
KEYRING_SERVICE = 'MalwareAnalyzerPro'
API_KEY_NAMES = {
    'virustotal': 'virustotal_api_key',
    'hybrid_analysis': 'hybrid_api_key',
    'metadefender': 'metadefender_api_key',
    'abuseipdb': 'abuseipdb_api_key',
    'urlscan': 'urlscan_api_key',
}

# Extensiones de archivos soportadas
SUPPORTED_FILE_TYPES = {
    'executables': ['.exe', '.dll', '.sys', '.msi', '.scr'],
    'scripts': ['.bat', '.cmd', '.ps1', '.vbs', '.js', '.py', '.sh'],
    'documents': ['.pdf', '.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx', '.rtf'],
    'archives': ['.zip', '.rar', '.7z', '.tar', '.gz', '.bz2'],
    'mobile': ['.apk', '.ipa', '.dex'],
    'others': ['.iso', '.img', '.dmg', '.pkg'],
}

# User Agent para requests
USER_AGENT = 'MalwareAnalyzerPro/1.0 (https://github.com/jalbraton/Proyectos_personales_)'

# Configuración de proxy (opcional)
PROXY_CONFIG = {
    'enabled': False,
    'http': None,  # 'http://proxy:port'
    'https': None,  # 'https://proxy:port'
}
